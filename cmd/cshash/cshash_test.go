package main

import (
	"github.com/KTiago/cshash"
	"testing"
)

func TestSum(t *testing.T) {
	tables := []struct {
		cert string
		csf  string
	}{
		{` -----BEGIN CERTIFICATE-----
MIIFTjCCBDagAwIBAgITBsndaKA74XoGKT0xtcYTevwVwjANBgkqhkiG9w0BAQsF
ADCBtTELMAkGA1UEBhMCVVMxETAPBgNVBAgTCElsbGlub2lzMRAwDgYDVQQHEwdD
aGljYWdvMSEwHwYDVQQKExhUcnVzdHdhdmUgSG9sZGluZ3MsIEluYy4xPTA7BgNV
BAMTNFRydXN0d2F2ZSBPcmdhbml6YXRpb24gVmFsaWRhdGlvbiBTSEEyNTYgQ0Es
IExldmVsIDExHzAdBgkqhkiG9w0BCQEWEGNhQHRydXN0d2F2ZS5jb20wHhcNMTcx
MjIxMTYwMzQxWhcNMjAxMjE3MjIwMzQxWjBcMREwDwYDVQQDEwh0ZXN0LmNvbTEX
MBUGA1UEChMOVGVzdC5jb20sIEluYy4xEjAQBgNVBAcTCUNsZXZlbGFuZDENMAsG
A1UECBMET2hpbzELMAkGA1UEBhMCVVMwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAw
ggEKAoIBAQCm1mxQegPfnWGOY8GS8VvcJJabbjMvpvRV0GqWle0Epjtx19W9cGSN
YUGWgA2mDi94bKViaEIJynIYnR9RbdM+e+XX1/4F1VtKiJHqFcUzO0Q72OiCbLkm
sEyrPBVbMvVSMi/qa8htK7swmBOMh4CkkzupN3Yqr7B/8RuRIWN6KqIeFPB3XrBB
LMtEU1vRAvlaA6hg2PNyLKVnMIXbeMzrwAueJGgfRUZxAh+QW/aomhE2DH9XSFpj
NeHInCq892g6QeaACHbaTmK9AcdCU5b57C+GagaBtxqSPQDLSTkAwYibcESlAM7r
q0bJ8KmBMSUQdmOxBl8oeoPdZ3H9sD5RAgMBAAGjggGtMIIBqTAMBgNVHRMBAf8E
AjAAMA4GA1UdDwEB/wQEAwIFoDAdBgNVHSUEFjAUBggrBgEFBQcDAgYIKwYBBQUH
AwEwHQYDVR0OBBYEFPfGVr2abTX32FWs13wdp2e9yWKvMB8GA1UdIwQYMBaAFMrO
HRgDdx4c83xYsppwqAiAFvSuMD8GA1UdIAQ4MDYwNAYGZ4EMAQICMCowKAYIKwYB
BQUHAgEWHGh0dHBzOi8vc3NsLnRydXN0d2F2ZS5jb20vQ0EwPgYDVR0RBDcwNYII
dGVzdC5jb22CDHd3dy50ZXN0LmNvbYIPc2VjdXJlLnRlc3QuY29tggoqLnRlc3Qu
Y29tMDYGA1UdHwQvMC0wK6ApoCeGJWh0dHA6Ly9jcmwudHJ1c3R3YXZlLmNvbS9P
VkNBMl9MMS5jcmwwcQYIKwYBBQUHAQEEZTBjMCYGCCsGAQUFBzABhhpodHRwOi8v
b2NzcC50cnVzdHdhdmUuY29tLzA5BggrBgEFBQcwAoYtaHR0cDovL3NzbC50cnVz
dHdhdmUuY29tL2lzc3VlcnMvT1ZDQTJfTDEuY3J0MA0GCSqGSIb3DQEBCwUAA4IB
AQA7QPQmMfZxHY0Z00pKrKvFr7k4pJicodm/ppJRm0Kjv29+raj3H2poa6AymzwQ
exOnvzaTHv3Oer9cHLjML5gzdDPbEi0RXaY/Xulo0A6WwAMIjmxBqS5MWBBzpggU
bNXig91UQ2zkoQW93V9SPiTRiM+K6Lim3pB7NgPjRYjBZybIS9+GHmN5YRAw9wSl
0fyG+66tkvyl6TnorrKNuwp1UT6sPXYZvyVgp9SA6N0p3F2gsKtBg5OrSjwHJTCz
hKFaEiGTCWzxpwaYjK1jHEw6t0FXA2AyEK716RnUbBfgqf87awaRzW3OMbEG+6rS
J3s4obQK+wg2GhXM6jwqRu8d
-----END CERTIFICATE----- `, "4a88f1b1e334cdfcfeee5c5f17ca57fc"},
		{` -----BEGIN CERTIFICATE-----
MIIEeDCCA2CgAwIBAgISA0M5MgFWkk8zPqh30gOvuY5FMA0GCSqGSIb3DQEBCwUA
MEoxCzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MSMwIQYDVQQD
ExpMZXQncyBFbmNyeXB0IEF1dGhvcml0eSBYMzAeFw0yMDAzMDcxNzEwMzJaFw0y
MDA2MDUxNzEwMzJaMBoxGDAWBgNVBAMTD2xldHNlbmNyeXB0Lm9yZzCCASIwDQYJ
KoZIhvcNAQEBBQADggEPADCCAQoCggEBANPsfOHCbX+hyF+ESn1RU+2tx6ss7Caq
WvXIM2iwg85wdyq+7Abj02o0Di5rDcUFeACT/YKS+ynzeax4wDY0gYgLujgnDuMN
6+AqQdf9uU+co/PhJ7FZGEB4zR4N1lzoO7iFmETg6EXjGFi8rpEbmag/1SYl0AVR
tPtyVzaUmXZoqAsv9ikXhM4ehslSkY/0VrD+YaYQJRf3nhJskEQ13AhQu07ZsXMz
HlqsEkDPZj59k87f4GzKp9KxQvBcHzmkpsSUkfSrKtDFtybJ342Nchadim7h9y96
MjiAQ2+6F2hW9Hh92eWrcHxIUCaVOxghZv28cBt4e+gMC5O2tuzuX4ECAwEAAaOC
AYYwggGCMA4GA1UdDwEB/wQEAwIFoDAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYB
BQUHAwIwDAYDVR0TAQH/BAIwADAdBgNVHQ4EFgQUO+r8VvPLzeECO+52tg87AcnQ
T4MwHwYDVR0jBBgwFoAUqEpqYwR93brm0Tm3pkVl7/Oo7KEwbwYIKwYBBQUHAQEE
YzBhMC4GCCsGAQUFBzABhiJodHRwOi8vb2NzcC5pbnQteDMubGV0c2VuY3J5cHQu
b3JnMC8GCCsGAQUFBzAChiNodHRwOi8vY2VydC5pbnQteDMubGV0c2VuY3J5cHQu
b3JnLzAvBgNVHREEKDAmgg9sZXRzZW5jcnlwdC5vcmeCE3d3dy5sZXRzZW5jcnlw
dC5vcmcwTAYDVR0gBEUwQzAIBgZngQwBAgEwNwYLKwYBBAGC3xMBAQEwKDAmBggr
BgEFBQcCARYaaHR0cDovL2Nwcy5sZXRzZW5jcnlwdC5vcmcwEwYKKwYBBAHWeQIE
AwEB/wQCBQAwDQYJKoZIhvcNAQELBQADggEBAGm1gXNBJzLJTocVsEO178bp+Qf6
/diu4SnqQtx8hrBD8UkkLhaZ1umWDDdrklXWcg4oZvk1JPy2sJm/an27TKMsD08M
LWzmcVTvD8OqFYKgsGLqKEaDBnsAKHUgzfKmnfFDpRi3cGttN9vRViTB1UK5lMc/
xtdJDTpzORoa2C1OkF1LBhnlNlyMMdUyN78TaGqhU8CbbwzeSTViiyfXsPm1fA95
EhggK+3ODQrFsG6mROD0kE1wUO7Xps1NS4FnEvzMinhpCH7fq0C8Fmn6FgoQncfK
j+WD8wIggrrsg8UkSjhh6Yl+xN5bzICxHfyb2S06eXv/MSeGE4CYzA+Dl7E=
-----END CERTIFICATE----- `, "de06a93c578c15e22782a9e18e87bd29"},
		{ `-----BEGIN CERTIFICATE-----
MIIEuTCCA6GgAwIBAgIQQBrEZCGzEyEDDrvkEhrFHTANBgkqhkiG9w0BAQsFADCB
vTELMAkGA1UEBhMCVVMxFzAVBgNVBAoTDlZlcmlTaWduLCBJbmMuMR8wHQYDVQQL
ExZWZXJpU2lnbiBUcnVzdCBOZXR3b3JrMTowOAYDVQQLEzEoYykgMjAwOCBWZXJp
U2lnbiwgSW5jLiAtIEZvciBhdXRob3JpemVkIHVzZSBvbmx5MTgwNgYDVQQDEy9W
ZXJpU2lnbiBVbml2ZXJzYWwgUm9vdCBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eTAe
Fw0wODA0MDIwMDAwMDBaFw0zNzEyMDEyMzU5NTlaMIG9MQswCQYDVQQGEwJVUzEX
MBUGA1UEChMOVmVyaVNpZ24sIEluYy4xHzAdBgNVBAsTFlZlcmlTaWduIFRydXN0
IE5ldHdvcmsxOjA4BgNVBAsTMShjKSAyMDA4IFZlcmlTaWduLCBJbmMuIC0gRm9y
IGF1dGhvcml6ZWQgdXNlIG9ubHkxODA2BgNVBAMTL1ZlcmlTaWduIFVuaXZlcnNh
bCBSb290IENlcnRpZmljYXRpb24gQXV0aG9yaXR5MIIBIjANBgkqhkiG9w0BAQEF
AAOCAQ8AMIIBCgKCAQEAx2E3XrEBNNti1xWb/1hajCMj1mCOkdeQmIN65lgZOIzF
9uVkhbSicfvtvbnazU0AtMgtc6XHaXGVHzk8skQHnOgO+k1KxCHfKWGPMiJhgsWH
H26MfF8WIFFE0XBPV+rjHOPMee5Y2A7Cs0WTwCznmhcrewA3ekEzeOEz4vMQGn+H
LL729fdC4uW/h2KJXwBL38Xd5HVEMkE6HnFuacsLdUYI0crSK5XQz/u5QGtkjFdN
/BMReYTtXlT2NJ8IAfMQJQYXStrxHXpma5hgZqTZ79IugvHw7wnqRMkVauIDbjPT
rJ9VAMf2CGqUuV/c4DPxhGD5WycRtPwW8rtWaoAljQIDAQABo4GyMIGvMA8GA1Ud
EwEB/wQFMAMBAf8wDgYDVR0PAQH/BAQDAgEGMG0GCCsGAQUFBwEMBGEwX6FdoFsw
WTBXMFUWCWltYWdlL2dpZjAhMB8wBwYFKw4DAhoEFI/l0xqGrI2Oa8PPgGrUSBgs
exkuMCUWI2h0dHA6Ly9sb2dvLnZlcmlzaWduLmNvbS92c2xvZ28uZ2lmMB0GA1Ud
DgQWBBS2d/ppSEefUxLVwuoHMnYH0ZcHGTANBgkqhkiG9w0BAQsFAAOCAQEASvj4
sAPmLGd75JR3Y8xuTPl9Dg3cyLk1uXBPY/ok+myDjEedO2Pzmvl2MpWRsXe8rJq+
seQxIcaBlVZaDrHC1LGmWazxY8u4TB1ZkErvkBYoH1quEPuBUDgMbMzxPcP1Y+Oz
4yHJJDnp/RVmRvQbEdBNc6N9Rvk97ahfYtTxP/jgdFcrGJ2BtMQo2pSXpXDrrB2+
BxHw1dvd5Yzw1TKwg+ZX4o+/vqGqvz0dtdQ46tewXDpPaj+PwGZsY6rp2aQW9IHR
lRQOfc2VNNnSj3BzgXucfr2YYdhFh5iQxeuGMMY1v/D/w1WIg0vvBZIGcfK4mJO3
7M2CYfE45k+XmCpajQ==
-----END CERTIFICATE----- `, "858741e6c798f495b3f67f63856a7f81"},
	}

	for _, table := range tables {
		certDer, err := cshash.PEMToDER(table.cert)
		if err != nil{
			panic(err)
		}
		csf := cshash.Fingerprint(certDer)
		if csf != table.csf {
			t.Errorf("cshash of (%s) was incorrect, got: %s, want: %s.", table.cert, csf, table.csf)
		}
	}
}
